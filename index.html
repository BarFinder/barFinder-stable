<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>BarFinder App 5</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0", maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" type="text/css" href="jquery.mobile-1.4.5.min.css">
  <script
        src="https://code.jquery.com/jquery-1.11.1.min.js"
        integrity="sha256-VAvG3sHdS5LqTT+5A/aeq/bZGa/Uj04xKxY8KM/w9EE="
        crossorigin="anonymous"></script>
  <script src="jquery.mobile-1.4.5.min.js"></script>
  <link rel="stylesheet" type="text/css" href="barFinderStyle.css">
</head>

<body>
  <div data-role="page">

    <div data-role="header">
      <h1>BarFinder</h1>
    </div><!-- /header -->

    <div role="main" class="ui-content">
      <div id="map">There is an issue with Maps</div>

      <script>
        /*
         * Google Maps documentation: http://code.google.com/apis/maps/documentation/javascript/basics.html
         * https://developers.google.com/maps/documentation/javascript/geolocation
         * https://developers.google.com/web/fundamentals/native-hardware/user-location/#ask_permission_responsibly
         * Geolocation documentation: http://dev.w3.org/geo/api/spec-source.html
         */

        function initMap() {
          let mapCanvas = document.getElementById("map");
          let mapOptions = {
              center: new google.maps.LatLng(59.33, 18.06),
              zoom: 12
          };

          let map = new google.maps.Map(mapCanvas, mapOptions);

          var infoWindow = new google.maps.InfoWindow({map: map});

          // Try HTML5 geolocation
          if ( navigator.geolocation ) {
            function success(position) {
              // Location found, show map with these coordinates
              let pos = {
                lat: position.coords.latitude, 
                lng: position.coords.longitude
              };

              infoWindow.setPosition(pos);
              infoWindow.setContent('Location found.');
              map.setCenter(pos);
            }

            function fail(error) {
              handleLocationError(true, infoWindow, map.getCenter());  // Failed to find location
            }

            // Find the users current position.  Cache the location for 5 minutes, timeout after 6 seconds
            navigator.geolocation.getCurrentPosition(success, fail, {maximumAge: 500000, enableHighAccuracy:true, timeout: 6000});
          } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter()); 
          }

          function handleLocationError(browserHasGeolocation, infoWindow, pos) {
          infoWindow.setPosition(pos);
          infoWindow.setContent(browserHasGeolocation ?
                                'Error: The Geolocation service failed.' :
                                'Error: Your browser doesn\'t support geolocation.');
          }


          // Add an overlay to the map of current lat/lng
          /*
          let marker = new google.maps.Marker({
            position: latlng,
            map: map,
            title: "You are here"
          });*/
        } 


         
      </script>
      <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAhV4PqPRqoSASvwP4oD1BSa-A-cxSHwzs&callback=initMap"></script>
    </div><!-- /content -->


    <div data-role="footer" data-position="fixed">
      <div data-role="navbar">

        <ul>
          <li><a href="#" data-prefetch="true" data-transition="slide" data-role="button" data-icon="location" data-iconpos="top" data-position="fixed" class="ui-btn-active ui-state-persist"></a></li>
          <li><a href="#" data-role="button" data-icon="none" data-iconpos="top" data-position="fixed" ui-state-persist"></a></li>
        </ul>

      </div><!-- /navbar -->
    </div> <!--/footer -->

  </div><!-- /page -->

</body>
</html> 
